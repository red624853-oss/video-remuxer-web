<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Remuxer</title>
    <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@latest"></script>
</head>
<body>
    <h1>Video Remuxer</h1>
    <input type="file" id="videoInput" accept="video/*">
    <button id="remuxButton">Remux Video</button>
    <video id="videoPreview" controls></video>
    <script>
        const { createFFmpeg, fetchFile } = FFmpeg;
        const ffmpeg = createFFmpeg({ log: true });

        document.getElementById('remuxButton').onclick = async () => {
            const fileInput = document.getElementById('videoInput');
            if (fileInput.files.length === 0) {
                alert("Please upload a video file.");
                return;
            }

            const file = fileInput.files[0];
            const fileName = file.name;
            const outputFileName = fileName.split('.').slice(0, -1).join('.') + '-remuxed.mp4';

            // Load FFmpeg
            if (!ffmpeg.isLoaded()) {
                await ffmpeg.load();
            }

            // Write the file to FFmpeg's filesystem
            ffmpeg.FS('writeFile', fileName, await fetchFile(file));

            // Remux the video to mp4 format
            await ffmpeg.run('-i', fileName, outputFileName);

            // Read the remuxed file from FFmpeg's filesystem
            const data = ffmpeg.FS('readFile', outputFileName);

            // Create a Blob URL for the output file
            const videoUrl = URL.createObjectURL(new Blob([data.buffer], { type: 'video/mp4' }));

            // Update the video preview source
            const videoPreview = document.getElementById('videoPreview');
            videoPreview.src = videoUrl;
            videoPreview.load();
            videoPreview.play();
        };
    </script>
</body>
</html>
